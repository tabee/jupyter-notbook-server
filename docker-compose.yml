services:
  jupyter:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        USER_ID: ${USER_ID}
        GROUP_ID: ${GROUP_ID}
    container_name: ${CONTAINER_NAME}
    restart: unless-stopped
    ports:
      # Bind only to localhost for security (comment out when using Traefik)
      - "127.0.0.1:${JUPYTER_PORT}:8888"
    volumes:
      # Mount projects directory
      - ${PROJECTS_DIR}:/home/jupyter/jupyter-work
    networks:
      - default
    # Uncomment labels below for Traefik integration (VPS deployment)
    # IMPORTANT: Set JUPYTER_DOMAIN in .env before uncommenting
    # labels:
    #   traefik.enable: "true"
    #   traefik.http.routers.jupyter.rule: "Host(`${JUPYTER_DOMAIN}`)"
    #   traefik.http.routers.jupyter.entrypoints: "websecure"
    #   traefik.http.routers.jupyter.tls.certresolver: "letsencrypt"
    #   traefik.http.services.jupyter.loadbalancer.server.port: "8888"
    #   # Authentication middleware (recommended for production)
    #   traefik.http.routers.jupyter.middlewares: "jupyter-auth"
    #   traefik.http.middlewares.jupyter-auth.basicauth.users: "admin:$$apr1$$..."

networks:
  default:
    name: ${TRAEFIK_NETWORK}
    # Set to true if using an existing Traefik network
    # Set to false if this should create its own network
    external: ${TRAEFIK_NETWORK_EXTERNAL:-false}
